<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36" version="28.1.2">
  <diagram name="第 1 页" id="D7XwczhKFFFPfdhn7USf">
    <mxGraphModel dx="983" dy="521" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-429" value="客户端请求" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="150" height="4316" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-430" value="HighExposureLowConversionFilter" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="220" y="20" width="261" height="4316" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-431" value="ExperimentLoader" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="531" y="20" width="150" height="4316" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-432" value="欧拉配置&#xa;(地区配置+全局阈值)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="731" y="20" width="169" height="4316" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-433" value="HighExposureLowConversionCache&#xa;(ConcurrentHashMap)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="950" y="20" width="268" height="4316" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-434" value="Redis Set&#xa;(region列表索引)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="1342" y="20" width="150" height="4316" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-435" value="Redis Hash数据&#xa;(按region分片)" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="1542" y="20" width="150" height="4316" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-436" value="日志系统" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="1742" y="20" width="150" height="4316" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-437" value="RetrievalResponse" style="shape=umlLifeline;perimeter=lifelinePerimeter;whiteSpace=wrap;container=1;dropTarget=0;collapsible=0;recursiveResize=0;outlineConnect=0;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;vertical&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};size=65;" vertex="1" parent="1">
          <mxGeometry x="1942" y="20" width="150" height="4316" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-438" value="alt" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=30" vertex="1" parent="1">
          <mxGeometry x="988" y="698" width="841" height="375" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-439" value="[region有数据]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-438">
          <mxGeometry x="30" width="811" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-440" value="[region无数据]" style="shape=line;dashed=1;whiteSpace=wrap;verticalAlign=top;labelPosition=center;verticalLabelPosition=middle;align=center;strokeColor=#B3B3B3;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-438">
          <mxGeometry y="154" width="841" height="4" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-441" value="[加载失败]" style="shape=line;dashed=1;whiteSpace=wrap;verticalAlign=top;labelPosition=center;verticalLabelPosition=middle;align=center;strokeColor=#B3B3B3;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-438">
          <mxGeometry y="282" width="841" height="4" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-442" value="loop" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=40" vertex="1" parent="1">
          <mxGeometry x="978" y="527" width="861" height="556" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-443" value="[遍历每个region]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-442">
          <mxGeometry x="40" width="821" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-444" value="" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=0" vertex="1" parent="1">
          <mxGeometry x="340" y="144" width="1509" height="1156" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-445" value="" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-444">
          <mxGeometry width="1509" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-446" value="alt" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=30" vertex="1" parent="1">
          <mxGeometry x="999" y="1849" width="830" height="354" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-447" value="[region有数据]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-446">
          <mxGeometry x="30" width="800" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-448" value="[region无数据]" style="shape=line;dashed=1;whiteSpace=wrap;verticalAlign=top;labelPosition=center;verticalLabelPosition=middle;align=center;strokeColor=#B3B3B3;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-446">
          <mxGeometry y="133" width="830" height="4" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-449" value="[加载失败]" style="shape=line;dashed=1;whiteSpace=wrap;verticalAlign=top;labelPosition=center;verticalLabelPosition=middle;align=center;strokeColor=#B3B3B3;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-446">
          <mxGeometry y="261" width="830" height="4" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-450" value="loop" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=40" vertex="1" parent="1">
          <mxGeometry x="989" y="1699" width="850" height="514" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-451" value="[遍历每个region]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-450">
          <mxGeometry x="40" width="810" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-452" value="" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=0" vertex="1" parent="1">
          <mxGeometry x="940" y="1359" width="908" height="1068" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-453" value="" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-452">
          <mxGeometry width="908" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-454" value="alt" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=30" vertex="1" parent="1">
          <mxGeometry x="267" y="3549" width="1562" height="338" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-455" value="[是高曝低消]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-454">
          <mxGeometry x="30" width="1532" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-456" value="[不是高曝低消]" style="shape=line;dashed=1;whiteSpace=wrap;verticalAlign=top;labelPosition=center;verticalLabelPosition=middle;align=center;strokeColor=#B3B3B3;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-454">
          <mxGeometry y="185" width="1562" height="4" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-457" value="alt" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=30" vertex="1" parent="1">
          <mxGeometry x="201" y="3266" width="1638" height="841" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-458" value="[缓存命中（region存在）]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-457">
          <mxGeometry x="30" width="1608" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-459" value="[缓存未命中（region不存在）]" style="shape=line;dashed=1;whiteSpace=wrap;verticalAlign=top;labelPosition=center;verticalLabelPosition=middle;align=center;strokeColor=#B3B3B3;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-457">
          <mxGeometry y="636" width="1638" height="4" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-460" value="loop" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=40" vertex="1" parent="1">
          <mxGeometry x="191" y="2983" width="1658" height="1134" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-461" value="[遍历候选广告]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-460">
          <mxGeometry x="40" width="1618" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-462" value="alt" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=30" vertex="1" parent="1">
          <mxGeometry x="84" y="2662" width="1944" height="1569" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-463" value="[实验关闭]" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-462">
          <mxGeometry x="30" width="1914" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-464" value="[实验开启]" style="shape=line;dashed=1;whiteSpace=wrap;verticalAlign=top;labelPosition=center;verticalLabelPosition=middle;align=center;strokeColor=#B3B3B3;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-462">
          <mxGeometry y="155" width="1944" height="4" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-465" value="" style="shape=umlFrame;dashed=1;pointerEvents=0;dropTarget=0;strokeColor=#B3B3B3;height=20;width=0" vertex="1" parent="1">
          <mxGeometry x="74" y="2486" width="1964" height="1755" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-466" value="" style="text;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="sRduOmiLx5QWzCSMZnZ5-465">
          <mxGeometry width="1964" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-467" value="@PostConstruct init()" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="726" y="196" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-468" value="log.info(&quot;[高曝低消缓存] 初始化开始&quot;)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-436">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1459" y="248" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-469" value="SMEMBERS&#xa;ad:show:recall:low:conversion:regions" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-434">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1259" y="321" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-470" value="Set{IN, MY, JP, ...}" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-434" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1262" y="373" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-471" value="log.info(&quot;[高曝低消缓存] 开始加载{}个region的数据&quot;, regions.size())" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-436">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1459" y="425" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-473" value="HGETALL&#xa;ad:show:recall:low:conversion:{region}" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-435">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1359" y="626" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-474" value="Hash{appId: &quot;exposure,activation&quot;}" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-435" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1362" y="678" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-475" value="解析数据存入newCache&#xa;appId -&gt; AdStatData" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="797" />
              <mxPoint x="1135" y="827" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-476" value="跳过（不缓存空region）" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="925" />
              <mxPoint x="1135" y="955" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-477" value="log.error(&quot;[高曝低消缓存] 加载region数据失败: {}&quot;, region, e)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-436">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1459" y="1053" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-478" value="regionCache = newCache&#xa;(替换Map引用)" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="1146" />
              <mxPoint x="1135" y="1176" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-479" value="log.info(&quot;[高曝低消缓存] 加载完成: 有数据={}, 空数据={}, 失败={}, 耗时={}ms&quot;)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-436">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1459" y="1228" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-480" value="初始化完成" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="729" y="1280" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-481" value="@Scheduled(cron=&quot;0 0 * * * ?&quot;)" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="1411" />
              <mxPoint x="1135" y="1441" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-482" value="log.info(&quot;[高曝低消缓存] 定时任务开始全量刷新&quot;)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-436">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1459" y="1493" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-483" value="SMEMBERS获取region列表" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-434">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1259" y="1545" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-484" value="Set{IN, MY, JP, ...}" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-434" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1262" y="1597" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-485" value="构建新ConcurrentHashMap" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="1649" />
              <mxPoint x="1135" y="1679" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-486" value="HGETALL获取数据" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-435">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1359" y="1777" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-487" value="Hash数据" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-435" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1362" y="1829" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-488" value="解析并存入newCache" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="1927" />
              <mxPoint x="1135" y="1957" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-489" value="跳过（不缓存）" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="2055" />
              <mxPoint x="1135" y="2085" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-490" value="log.error(&quot;[高曝低消缓存] 加载region数据失败: {}&quot;, region, e)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-436">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1459" y="2183" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-491" value="regionCache = newCache&#xa;(原子替换)" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="2276" />
              <mxPoint x="1135" y="2306" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-492" value="log.info(&quot;[高曝低消缓存] 定时任务刷新完成: 有数据={}, 空数据={}, 失败={}, 耗时={}ms&quot;)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-436">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1459" y="2407" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-493" value="请求广告召回" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-429" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="231" y="2538" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-494" value="检查实验开关" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-431">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="487" y="2590" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-495" value="是否启用过滤器" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-431" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="490" y="2642" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-496" value="log.debug(&quot;实验关闭，不过滤&quot;)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-436">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1092" y="2740" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-497" value="不过滤，继续召回" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-429">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="234" y="2792" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-498" value="获取阈值配置&#xa;(地区配置 &gt; 全局阈值)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-432">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="592" y="2911" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-499" value="曝光阈值、激活阈值" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-432" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="595" y="2963" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-500" value="getAppData(region, appId)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="726" y="3061" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-501" value="读取regionCache&#xa;Map cache = regionCache" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="3134" />
              <mxPoint x="1135" y="3164" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-502" value="cache.get(region)" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="3216" />
              <mxPoint x="1135" y="3246" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-503" value="appDataMap.get(appId)" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-433">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1135" y="3344" />
              <mxPoint x="1135" y="3374" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-504" value="AdStatData{exposure, activation}" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="729" y="3426" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-505" value="判断是否高曝低消&#xa;exposure &gt;= 阈值 &amp;&amp; activation &lt; 阈值" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="402" y="3499" />
              <mxPoint x="402" y="3529" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-506" value="log.debug(&quot;过滤高曝低消广告: region={}, appId={}&quot;, region, appId)" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-436">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1092" y="3627" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-507" value="过滤掉该广告" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="402" y="3679" />
              <mxPoint x="402" y="3709" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-508" value="保留该广告" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="402" y="3807" />
              <mxPoint x="402" y="3837" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-509" value="null（查不到）" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-433" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="729" y="3975" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-510" value="不过滤（保留广告）" style="curved=1;endArrow=block;rounded=0;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-430">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="402" y="4027" />
              <mxPoint x="402" y="4057" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-511" value="返回过滤后的广告列表" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-430" target="sRduOmiLx5QWzCSMZnZ5-437">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1192" y="4159" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-512" value="召回结果" style="verticalAlign=bottom;edgeStyle=elbowEdgeStyle;elbow=vertical;curved=0;rounded=0;dashed=1;dashPattern=2 3;endArrow=block;" edge="1" parent="1" source="sRduOmiLx5QWzCSMZnZ5-437" target="sRduOmiLx5QWzCSMZnZ5-429">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1068" y="4211" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-513" value="系统启动初始化阶段" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="1059" y="95" width="583" height="49" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-514" value="定时任务刷新（每小时整点）" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="1059" y="1310" width="583" height="49" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-515" value="几秒后读线程自然能看到新数据" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="950" y="2326" width="268" height="49" as="geometry" />
        </mxCell>
        <mxCell id="sRduOmiLx5QWzCSMZnZ5-516" value="请求处理阶段" style="fillColor=#ffff88;strokeColor=#9E916F;" vertex="1" parent="1">
          <mxGeometry x="70" y="2437" width="1972" height="49" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
